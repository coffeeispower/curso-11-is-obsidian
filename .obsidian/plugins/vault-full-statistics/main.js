/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var V=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var U=(a,s)=>{for(var t in s)V(a,t,{get:s[t],enumerable:!0})},q=(a,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of $(s))!K.call(a,i)&&i!==t&&V(a,i,{get:()=>s[i],enumerable:!(e=H(s,i))||e.enumerable});return a};var G=a=>q(V({},"__esModule",{value:!0}),a);var Z={};U(Z,{default:()=>F});module.exports=G(Z);var S=require("obsidian");var w=class{},r=class extends w{constructor(t){super();this.unit=t,this.numberFormat=Intl.NumberFormat("en-US",{style:"decimal"})}format(t){return`${this.numberFormat.format(t)} ${this.unit}`}},y=class extends w{constructor(t){super();this.numberFormat=t}format(t){let[e,i]=this.scale(t);return`${this.numberFormat.format(e)} ${i}`}},m=class extends y{constructor(){super(Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}))}scale(s){let t=["bytes","KB","MB","GB","TB","PB"];for(;s>1024&&t.length>0;)s=s/1024,t.shift();return[s,t[0]]}};var O=require("obsidian"),u=class extends O.Events{constructor(){super(...arguments);this.files=0;this.notes=0;this.attachments=0;this.size=0;this.links=0;this.words=0;this.quality=1e-5;this.tags=0}reset(){this.files=0,this.notes=0,this.attachments=0,this.size=0,this.links=0,this.words=0,this.quality=1e-5,this.tags=0}dec(t){this.files-=(t==null?void 0:t.files)||0,this.notes-=(t==null?void 0:t.notes)||0,this.attachments-=(t==null?void 0:t.attachments)||0,this.size-=(t==null?void 0:t.size)||0,this.links-=(t==null?void 0:t.links)||0,this.words-=(t==null?void 0:t.words)||0,this.quality=this.links/this.notes||1e-5,this.tags-=(t==null?void 0:t.tags)||0,this.trigger("updated")}inc(t){this.files+=(t==null?void 0:t.files)||0,this.notes+=(t==null?void 0:t.notes)||0,this.attachments+=(t==null?void 0:t.attachments)||0,this.size+=(t==null?void 0:t.size)||0,this.links+=(t==null?void 0:t.links)||0,this.words+=(t==null?void 0:t.words)||0,this.quality=this.links/this.notes||1e-5,this.tags+=(t==null?void 0:t.tags)||0,this.trigger("updated")}on(t,e,i){return super.on("updated",e,i)}};var g=require("obsidian");var I=class{tokenize(s){return[]}},N=class{isNonWord(s){return!!/^[^\wа-яА-ЯёЁ]+$/.exec(s)}isNumber(s){return!!/^\d+(\.\d+)?$/.exec(s)}isCodeBlockHeader(s){return!!/^```\w+$/.exec(s)}stripHighlights(s){let e=/^(==)?(.*?)(==)?$/.exec(s);return e?e[2]:s}stripFormatting(s){let e=/^(_+|\*+)?(.*?)(_+|\*+)?$/.exec(s);return e===null?null:e[2]}stripPunctuation(s){let e=/^(`|\.|:|"|,|!|\?)?(.*?)(`|\.|:|"|,|!|\?)?$/.exec(s);return e===null?s:e[2]}stripWikiLinks(s){let e=/^(\[\[)?(.*?)(\]\])?$/.exec(s);return e===null?s:e[2]}stripAll(s){if(s==="")return s;let t=!1;for(;!t;){let e=s;s=[s].map(this.stripHighlights).map(this.stripFormatting).map(this.stripPunctuation).map(this.stripWikiLinks)[0],t=t||e===s}return s}tokenize(s){if(s.trim()==="")return[];{let t=/[ \n\r\t\"\|,\(\)\[\]/]+/;return s.split(t).filter(i=>!this.isNonWord(i)).filter(i=>!this.isNumber(i)).filter(i=>!this.isCodeBlockHeader(i)).map(i=>this.stripAll(i)).filter(i=>i.length>0)}}},n=new I,c=new N;var v=class{constructor(s){this.data=new Map;this.backlog=new Array;this.vaultMetrics=new u;this.owner=s}setVault(s){return this.vault=s,this}setMetadataCache(s){return this.metadataCache=s,this}setFullVaultMetrics(s){return this.vaultMetrics=s,this}start(){var s;return this.owner.registerEvent(this.vault.on("create",t=>{this.onfilecreated(t)})),this.owner.registerEvent(this.vault.on("modify",t=>{this.onfilemodified(t)})),this.owner.registerEvent(this.vault.on("delete",t=>{this.onfiledeleted(t)})),this.owner.registerEvent(this.vault.on("rename",(t,e)=>{this.onfilerenamed(t,e)})),this.owner.registerEvent(this.metadataCache.on("resolve",t=>{this.onfilemodified(t)})),this.owner.registerEvent(this.metadataCache.on("changed",t=>{this.onfilemodified(t)})),this.data.clear(),this.backlog=new Array,(s=this.vaultMetrics)==null||s.reset(),this.vault.getFiles().forEach(t=>{t instanceof g.TFolder||this.push(t)}),this.owner.registerInterval(+setInterval(()=>{this.processBacklog()},2e3)),this}push(s){if(s instanceof g.TFolder)return;let t=s instanceof g.TFile?s.path:s;this.backlog.contains(t)||this.backlog.push(t)}async processBacklog(){for(;this.backlog.length>0;){let s=this.backlog.shift();if(s==null)break;let t=this.vault.getAbstractFileByPath(s),e=await this.collect(t);e!=null&&this.update(s,e)}}async onfilecreated(s){this.push(s)}async onfilemodified(s){this.push(s)}async onfiledeleted(s){this.push(s)}async onfilerenamed(s,t){this.push(s),this.push(t)}getFileType(s){var t;return((t=s.extension)==null?void 0:t.toLowerCase())==="md"?1:2}async collect(s){let t;try{t=this.metadataCache.getFileCache(s)}catch(e){t=null}if(t===null)return null;switch(this.getFileType(s)){case 1:return new f(this.vault).collect(s,t);case 2:return new k().collect(s,t)}}update(s,t){var i,p,d;let e=s instanceof g.TFile?s.path:s;(p=this.vaultMetrics)==null||p.dec((i=this.data.get(e))!=null?i:new u),t==null?this.data.delete(e):this.data.set(e,t),(d=this.vaultMetrics)==null||d.inc(t)}},E=class{constructor(s){this.vault=s}async collect(s,t){var p,d,A,x;let e=new u;e.files=1,e.notes=1,e.attachments=0,e.size=(p=s.stat)==null?void 0:p.size,e.links=((d=t==null?void 0:t.links)==null?void 0:d.length)||0;let i=await this.vault.cachedRead(s).then(T=>{var B;return(B=t.sections)==null?void 0:B.map(h=>{var R,_,P,L;let M=h.type,D=(_=(R=h.position)==null?void 0:R.start)==null?void 0:_.offset,W=(L=(P=h.position)==null?void 0:P.end)==null?void 0:L.offset,z=E.TOKENIZERS.get(M);return z?z.tokenize(T.substring(D,W)).length:(console.log(`${s.path}: no tokenizer, section.type=${h.type}`),0)}).reduce((h,M)=>h+M,0)}).catch(T=>(console.log(`${s.path} ${T}`),0));return e.words=i!=null?i:0,e.quality=e.links/e.notes,e.tags=(x=(A=t==null?void 0:t.tags)==null?void 0:A.length)!=null?x:0,e}},f=E;f.TOKENIZERS=new Map([["paragraph",c],["heading",c],["list",c],["table",n],["yaml",n],["code",n],["blockquote",c],["math",n],["thematicBreak",n],["html",n],["text",n],["element",n],["footnoteDefinition",n],["definition",n],["callout",c],["comment",n]]);var k=class{async collect(s,t){var i;let e=new u;return e.files=1,e.notes=0,e.attachments=1,e.size=(i=s.stat)==null?void 0:i.size,e.links=0,e.words=0,e.quality=0,e.tags=0,e}};var l=require("obsidian"),b=class extends l.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new l.Setting(t).setName("Show individual items").setDesc("Whether to show multiple items at once or cycle them with a click").addToggle(e=>{e.setValue(this.plugin.settings.displayIndividualItems).onChange(async i=>{this.plugin.settings.displayIndividualItems=i,this.display(),await this.plugin.saveSettings()})}),this.plugin.settings.displayIndividualItems&&(new l.Setting(t).setName("Show notes").addToggle(e=>{e.setValue(this.plugin.settings.showNotes).onChange(async i=>{this.plugin.settings.showNotes=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show attachments").addToggle(e=>{e.setValue(this.plugin.settings.showAttachments).onChange(async i=>{this.plugin.settings.showAttachments=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show files").addToggle(e=>{e.setValue(this.plugin.settings.showFiles).onChange(async i=>{this.plugin.settings.showFiles=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show links").addToggle(e=>{e.setValue(this.plugin.settings.showLinks).onChange(async i=>{this.plugin.settings.showLinks=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show words").addToggle(e=>{e.setValue(this.plugin.settings.showWords).onChange(async i=>{this.plugin.settings.showWords=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show size").addToggle(e=>{e.setValue(this.plugin.settings.showSize).onChange(async i=>{this.plugin.settings.showSize=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show tags").addToggle(e=>{e.setValue(this.plugin.settings.showTags).onChange(async i=>{this.plugin.settings.showTags=i,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show quality").addToggle(e=>{e.setValue(this.plugin.settings.showQuality).onChange(async i=>{this.plugin.settings.showQuality=i,await this.plugin.saveSettings()})}))}};var Q={displayIndividualItems:!1,showNotes:!1,showAttachments:!1,showFiles:!1,showLinks:!1,showWords:!1,showSize:!1,showQuality:!1,showTags:!1},F=class extends S.Plugin{constructor(){super(...arguments);this.statusBarItem=null}async onload(){console.log("Loading vault-statistics Plugin"),await this.loadSettings(),this.vaultMetrics=new u,this.vaultMetricsCollector=new v(this).setVault(this.app.vault).setMetadataCache(this.app.metadataCache).setFullVaultMetrics(this.vaultMetrics).start(),this.statusBarItem=new C(this,this.addStatusBarItem()).setFullVaultMetrics(this.vaultMetrics),this.addSettingTab(new b(this.app,this))}async loadSettings(){this.settings=Object.assign({},Q,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.statusBarItem&&this.statusBarItem.refresh()}},o=class{constructor(s){this.containerEl=s.createSpan({cls:["obsidian-vault-full-statistics--item"]}),this.setActive(!1)}setStatisticName(s){return this.containerEl.addClass(`obsidian-vault-full-statistics--item-${s}`),this}setFormatter(s){return this.formatter=s,this}setActive(s){return this.containerEl.removeClass("obsidian-vault-full-statistics--item--active"),this.containerEl.removeClass("obsidian-vault-full-statistics--item--inactive"),s?this.containerEl.addClass("obsidian-vault-full-statistics--item--active"):this.containerEl.addClass("obsidian-vault-full-statistics--item--inactive"),this}refresh(s){this.containerEl.setText(this.formatter(s))}getText(){return this.containerEl.getText()}},C=class{constructor(s,t){this.displayedStatisticIndex=0;this.statisticViews=[];this.refreshSoon=(0,S.debounce)(()=>{this.refresh()},2e3,!1);this.owner=s,this.statusBarItem=t,this.statisticViews.push(new o(this.statusBarItem).setStatisticName("notes").setFormatter(e=>new r("notes").format(e.notes))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("attachments").setFormatter(e=>new r("attachments").format(e.attachments))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("files").setFormatter(e=>new r("files").format(e.files))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("links").setFormatter(e=>new r("links").format(e.links))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("words").setFormatter(e=>new r("words").format(e.words))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("size").setFormatter(e=>new m().format(e.size))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("tags").setFormatter(e=>new r("tags").format(e.tags))),this.statisticViews.push(new o(this.statusBarItem).setStatisticName("QoV").setFormatter(e=>new r("QoV").format(e.quality))),this.statusBarItem.onClickEvent(()=>{this.onclick()})}setFullVaultMetrics(s){var t;return this.vaultMetrics=s,this.owner.registerEvent((t=this.vaultMetrics)==null?void 0:t.on("updated",this.refreshSoon)),this.refreshSoon(),this}refresh(){this.owner.settings.displayIndividualItems?(this.statisticViews[0].setActive(this.owner.settings.showNotes).refresh(this.vaultMetrics),this.statisticViews[1].setActive(this.owner.settings.showAttachments).refresh(this.vaultMetrics),this.statisticViews[2].setActive(this.owner.settings.showFiles).refresh(this.vaultMetrics),this.statisticViews[3].setActive(this.owner.settings.showLinks).refresh(this.vaultMetrics),this.statisticViews[4].setActive(this.owner.settings.showWords).refresh(this.vaultMetrics),this.statisticViews[5].setActive(this.owner.settings.showSize).refresh(this.vaultMetrics),this.statisticViews[6].setActive(this.owner.settings.showTags).refresh(this.vaultMetrics),this.statisticViews[7].setActive(this.owner.settings.showQuality).refresh(this.vaultMetrics)):this.statisticViews.forEach((s,t)=>{s.setActive(this.displayedStatisticIndex==t).refresh(this.vaultMetrics)}),this.statusBarItem.title=this.statisticViews.map(s=>s.getText()).join(`
`)}onclick(){this.owner.settings.displayIndividualItems||(this.displayedStatisticIndex=(this.displayedStatisticIndex+1)%this.statisticViews.length),this.refresh()}};

/* nosourcemap */